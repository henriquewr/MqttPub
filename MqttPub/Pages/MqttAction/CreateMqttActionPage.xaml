<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/maui/global"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MqttPub.Pages.MqttAction.CreateMqttActionPage"
             xmlns:viewmodel="clr-namespace:MqttPub.ViewModels.MqttActionModels.Create"
             x:DataType="viewmodel:CreateMqttActionViewModel"
             Title="Create Mqtt action">

    <VerticalStackLayout Padding="20">
        <Label Text="Name" />
        <Entry Text="{Binding MqttActionSave.Name}" />

        <Picker
            Title="MQTT Connection"
            ItemsSource="{Binding MqttConnections}"
            ItemDisplayBinding="{Binding DisplayName}"
            SelectedItem="{Binding MqttActionSave.MqttConnection}" />

        <Label Text="Mqtt Message" />
        <Entry Text="{Binding NewMqttMessage}" />
        <Button Text="Add message" Command="{Binding AddNewMqttMessageCommand}" IsEnabled="{Binding NewMqttMessageIsValid}"/>

        <CollectionView 
            CanReorderItems="True"
            ItemsSource="{Binding MqttActionSave.MqttMessages}">   

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="viewmodel:CreateMqttMessageSaveViewModel">
                    <Grid Padding="0,5">
                        <Border StrokeShape="RoundRectangle 5">
                            <Grid ColumnDefinitions="Auto,*,Auto">
                                <Label Text="{Binding Order}" VerticalOptions="Center" Padding="10"/>
                                <Entry Grid.Column="1" VerticalOptions="Center" HorizontalOptions="Fill" Text="{Binding Message}" FontSize="16" />

                                <Button Grid.Column="2"
                                    VerticalOptions="Center"
                                    HeightRequest="40"
                                    WidthRequest="40"
                                    Margin="10,10,10,10"
                                    Text="âœ•"
                                    FontSize="18"
                                    FontAttributes="Bold"
                                    BackgroundColor="Red"
                                    TextColor="White"
                                    Command="{Binding RemoveMqttMessageCommand, Source={RelativeSource AncestorType={x:Type viewmodel:CreateMqttActionViewModel}}}"
                                    CommandParameter="{Binding .}">
                                </Button>
                            </Grid>
                        </Border>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button Text="Save"
                Command="{Binding SaveCommand}" 
                Margin="0,20,0,0"
                HorizontalOptions="Fill"/>

    </VerticalStackLayout>
</ContentPage>